<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Prompt Manager</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="popup.css" />
  </head>
  <body>
    <header class="toolbar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <span class="title">Prompt Manager</span>
      </div>
      <div class="actions">
        <button id="btnNew" class="btn primary" title="New Prompt (Ctrl+N)">
          New
        </button>
        <button id="btnExport" class="btn" title="Export CSV">Export</button>
        <label for="fileImport" class="btn" title="Import CSV">Import</label>
        <input id="fileImport" type="file" accept=".csv,text/csv" hidden />
      </div>
    </header>

    <section class="filters">
      <input
        id="searchInput"
        type="search"
        placeholder="Search title or content... (Ctrl+F)"
        aria-label="Search"
      />
      <select id="groupFilter" aria-label="Filter by group">
        <option value="">All Groups</option>
      </select>
      <div style="display: flex; align-items: center; gap: 4px">
        <select id="subgroupFilter" aria-label="Filter by subgroup" disabled>
          <option value="">All Subgroups</option>
        </select>
        <button
          id="clearFilters"
          class="btn"
          title="Clear Group & Subgroup"
          style="padding: 4px 6px"
        >
          âœ•
        </button>
      </div>
      <span class="count" id="resultCount">0</span>
    </section>

    <section id="emptyState" class="empty hidden">
      <h2>No prompts yet</h2>
      <p>
        Create your first prompt. Organize by Group and Subgroup. All data stays
        local.
      </p>
      <button id="btnEmptyCreate" class="btn primary">Create a Prompt</button>
    </section>

    <section class="list">
      <table id="promptTable" aria-label="Prompt list">
        <thead>
          <tr>
            <th style="width: 28%">Title</th>
            <th style="width: 18%">Group</th>
            <th style="width: 18%">Subgroup</th>
            <th style="width: 18%">Modified</th>
            <th style="width: 18%">Actions</th>
          </tr>
        </thead>
        <tbody id="promptTbody"></tbody>
      </table>
    </section>

    <!-- Modal: Add/Edit Prompt -->
    <!-- NOTE: Added novalidate so our JS validation runs instead of HTML's -->
    <dialog id="promptDialog">
      <form method="dialog" id="promptForm" novalidate>
        <h3 id="dialogTitle">New Prompt</h3>

        <div class="row">
          <label>Group</label>
          <div class="grid-2">
            <!-- Removed required -->
            <select id="groupSelect"></select>
            <input
              id="groupNew"
              type="text"
              placeholder="Or create new group..."
            />
          </div>
        </div>

        <div class="row">
          <label>Subgroup</label>
          <div class="grid-2">
            <select id="subgroupSelect"></select>
            <input
              id="subgroupNew"
              type="text"
              placeholder="Or create new subgroup..."
            />
          </div>
        </div>

        <div class="row">
          <label for="titleInput">Title</label>
          <input id="titleInput" type="text" required maxlength="200" />
        </div>

        <div class="row">
          <label for="contentInput">Prompt Content</label>
          <textarea id="contentInput" rows="8" required></textarea>
        </div>

        <div id="formError" class="error" role="alert" aria-live="polite"></div>

        <menu class="dialog-actions">
          <button type="button" id="btnDialogCancel" class="btn">
            Cancel (Esc)
          </button>
          <button type="submit" id="btnDialogSave" class="btn primary">
            Save (Ctrl+Enter)
          </button>
        </menu>
        <input type="hidden" id="promptId" />
      </form>
    </dialog>

    <!-- Confirm Delete -->
    <dialog id="confirmDialog">
      <form method="dialog" id="confirmForm">
        <h3>Delete Prompt</h3>
        <p id="confirmText">Are you sure you want to delete this prompt?</p>
        <menu class="dialog-actions">
          <button type="button" id="btnConfirmCancel" class="btn">
            Cancel
          </button>
          <button type="submit" id="btnConfirmDelete" class="btn danger">
            Delete
          </button>
        </menu>
        <input type="hidden" id="confirmPromptId" />
      </form>
    </dialog>

    <!-- <footer class="footer">
      <span>The Knowledge Base</span>
    </footer> -->

    <script src="popup.js" type="module"></script>
  </body>
</html>
